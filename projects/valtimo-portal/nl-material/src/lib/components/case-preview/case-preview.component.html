<div @fadeIn>
  <nl-material-card
    *ngIf="(currentLang$ | async) as currentLang"
    [buttonText]="'Stel een vraag'"
    [secondaryButtonText]="'Bekijk aanvraag'"
    [subtitle]="(mode === currentPreviewMode) ? preview.code || '' : ''"
    [title]="preview.id + '.my' | translate"
    [type]="isClippingPreview() ? casePreviewClippingType : casePreviewCurrentType"
  >
    <ng-container *ngTemplateOutlet="extras"></ng-container>
    <ng-container *ngTemplateOutlet="tasks;context:{currentLang: currentLang}"></ng-container>
    <ng-container *ngTemplateOutlet="currentCaseActions;context:{currentLang: currentLang}"></ng-container>
  </nl-material-card>
</div>

<ng-template #extras>
  <div @fadeIn *ngIf="isClippingPreview()" class="clip" extra>
    <img src="assets/img/clip/clip_top.svg"/>
    <img src="assets/img/clip/clip_bottom.svg"/>
  </div>
  <div *ngIf="isCurrentCasePreview()" class="top-right-folder-design" extra>
    <div class="diagonal"></div>
    <div class="inner"></div>
  </div>
</ng-template>

<ng-template #tasks let-currentLang="currentLang">
  <ng-container *ngIf="previewTasks$ | async as previewTasks">
    <ul *ngIf="previewTasks.length > 0" [ngClass]="mode === currentPreviewMode ? 'current' : ''" class="tasks">
      <li
        *ngFor="let task of previewTasks; let i = index"
        [ngClass]="isCurrentCasePreview() && i === 0 ? 'first' : ''"
        class="task"
      >
        <div *ngIf="isCurrentCasePreview() && i === 0" class="line"></div>
        <div [ngClass]="{'empty': !task.completed}" class="circle-icon">
          <mat-icon *ngIf="task.completed" fontIcon="fa-check" fontSet="fa"></mat-icon>
          <mat-icon *ngIf="getOpenTasks(previewTasks)[0] === task" fontIcon="fa-arrow-right" fontSet="fa"></mat-icon>
        </div>
        <div *ngIf="isClippingPreview() || i !== 0" class="description">
          <span>{{preview.id + '.statuses.' + task.id | translate}}</span>
          <span *ngIf="isClippingPreview()">
          {{task.date | date: 'shortDate' : '' : currentLang}}
        </span>
        </div>
      </li>
    </ul>
  </ng-container>
</ng-template>

<ng-template #currentCaseActions let-currentLang="currentLang">
  <div
    *ngIf="mode === currentPreviewMode"
    class="current-case-actions"
  >
    <ng-container *ngIf="getCurrentCaseTasks(preview.tasks)[1] as task">
       <span>
      {{task.date | date: 'shortDate' : '' : currentLang}}
    </span>
    </ng-container>
    <button mat-button>
      <mat-icon fontIcon="fa-arrow-right" fontSet="fa"></mat-icon>
    </button>
  </div>
</ng-template>
