<div @fadeIn>
  <nl-material-card
    *ngIf="(currentLang$ | async) as currentLang"
    [buttonText]="'home.preview.primaryButtonText' | translate"
    [secondaryButtonText]="'home.preview.secondaryButtonText' | translate"
    [title]="preview.id + '.my' | translate"
    [type]="isClippingPreview() ? casePreviewClippingType : casePreviewCurrentType"
    (primaryButtonClick)="navigateToCase()"
  >
    <ng-container *ngTemplateOutlet="extras"></ng-container>
    <ng-container *ngIf="previewTasks$ | async as previewTasks">
      <ng-container
        *ngTemplateOutlet="tasks;context:{currentLang: currentLang, previewTasks: previewTasks}"></ng-container>
      <ng-container
        *ngTemplateOutlet="currentCaseActions;context:{currentLang: currentLang, previewTasks: previewTasks, preview: preview}"></ng-container>
    </ng-container>
  </nl-material-card>
</div>

<ng-template #extras>
  <div @fadeIn *ngIf="isClippingPreview()" class="clip" extra>
    <img src="assets/img/clip/clip_top.svg"/>
    <img src="assets/img/clip/clip_bottom.svg"/>
  </div>
  <div *ngIf="isCurrentCasePreview()" class="top-right-folder-design" extra>
    <div class="diagonal"></div>
    <div class="inner"></div>
  </div>
</ng-template>

<ng-template #tasks let-currentLang="currentLang" let-previewTasks="previewTasks">
  <nl-material-case-status
    [previewTasks]="previewTasks"
    [mode]="mode"
    [caseDefinitionId]="preview.id"
  >
  </nl-material-case-status>
</ng-template>

<ng-template #currentCaseActions let-currentLang="currentLang" let-previewTasks="previewTasks" let-preview="preview">
  <div
    *ngIf="mode === currentPreviewMode"
    class="current-case-actions"
  >
    <ng-container *ngIf="previewTasks[1]?.date as date">
      <ng-container *ngTemplateOutlet="date;context:{currentLang: currentLang, date: date}"></ng-container>
    </ng-container>
    <ng-container *ngIf="!previewTasks[1]?.date && preview.date">
      <ng-container *ngTemplateOutlet="date;context:{currentLang: currentLang, date: preview.date}"></ng-container>
    </ng-container>
    <button mat-button [routerLink]="caseRoute$ | async" [queryParams]="{id:preview.code}">
      <mat-icon fontIcon="fa-arrow-right" fontSet="fa"></mat-icon>
    </button>
  </div>
</ng-template>

<ng-template #date let-date="date" let-currentLang="currentLang">
      <span>
        {{date | date: 'shortDate' : '' : currentLang}}
      </span>
</ng-template>
